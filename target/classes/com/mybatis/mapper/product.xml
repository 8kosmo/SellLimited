<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper     PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"     "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mybatis.mapper.ProductMapper">
	
	<select id="productList" parameterType="map" resultType="map">
		SELECT * from sale_item
		WHERE mem_id = #{mem_id}
		
	</select>
	
	<select id="productIns" parameterType="map" statementType="CALLABLE">
      {call proc_AddProd(
      			   #{mem_id, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
                  ,#{brand , mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
                  ,#{product_name , mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
                  ,#{status , mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
                  ,#{sub_category , mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
                  ,#{modelname, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
                  ,#{explanation, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
                  ,#{attached_file, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
                  ,#{start_price, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
                  ,#{result, mode=OUT, jdbcType=VARCHAR, javaType=java.lang.String}
      )}
   </select>
   
   <update id="productUpd" parameterType="map">
   	UPDATE SALE_ITEM 
   	SET brand		 = #{brand}
   	   ,product_name = #{product_name}
   	   ,status		 = #{status}
   	   ,admin_ok	 = #{admin_ok}
   	   ,sub_category_code =(SELECT sub_category_code FROM sub_category WHERE sub_category = #{sub_category}) 
   	   ,modelname 	 = #{modelname}
   	   ,explanation	 = #{explanation}
   	   ,attached_file= #{attached_file}
   		WHERE item_code = #{item_code}
   </update>
   
   
	<select id="productDel" parameterType="map" statementType="CALLABLE">
	 {call proc_ProdDelete(#{item_code, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
	 					   ,#{result, mode=OUT, jdbcType=VARCHAR, javaType=java.lang.String})}
	</select>
<!-- 관리자 승인 이후 트랜잭션 처리 -->
	<update id="managerPermission" parameterType="map">
		UPDATE SALE_ITEM 
   		   SET status = '시드참여중'
 		 WHERE item_code = #{item_code}
   		   AND mem_id = #{mem_id}
	</update>
	<!-- AUCTION_INFO 테이블 안에 시드 시작,종료 -->
 	<insert id="auction_infoIn" parameterType="map">
		INSERT INTO AUCTION_INFO
		VALUES (#{item_code}
		       ,#{item_code}
		       ,(SELECT SYSDATE FROM DUAL)
		       ,(SELECT SYSDATE+ (INTERVAL '3' DAY)
		       	   FROM DUAL)
		       )
	</insert>
	<!-- AUCT_PROGRESS 테이블 안에 경매 시작,종료 -->
	<insert id="auct_progressIns" parameterType="map">
		INSERT INTO AUCT_PROGRESS
		VALUES (#{item_code}
		       ,(SELECT SYSDATE+ (INTERVAL '3' DAY)
		       	   FROM DUAL)
		       ,(SELECT SYSDATE+ (INTERVAL '3' DAY)+(INTERVAL #{auct_period} HOUR)
  				   FROM DUAL)
		       )
	</insert> 
</mapper>
